<!DOCTYPE html>
<html lang="zh-Hant-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Á©øÊ¢≠Â∑¥Â£´ÊôÇÂàªË°® | Shuttle Bus Schedule</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöå</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@300;400;500;700;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/* ========== RESET & VARS ========== */
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0e1a;--bg2:#111827;
  --glass:rgba(255,255,255,0.03);--glass-h:rgba(255,255,255,0.07);
  --bdr:rgba(255,255,255,0.06);--bdr-l:rgba(255,255,255,0.12);
  --t1:#f1f5f9;--t2:#cbd5e1;--t3:#94a3b8;--t4:#475569;
  --teal:#2dd4bf;--teal-d:rgba(45,212,191,0.13);
  --cyan:#22d3ee;--cyan-d:rgba(34,211,238,0.13);
  --violet:#a78bfa;--violet-d:rgba(167,139,250,0.13);
  --purple:#c084fc;--purple-d:rgba(192,132,252,0.13);
  --amber:#fbbf24;--amber-d:rgba(251,191,36,0.13);
  --green:#34d399;--red:#f87171;
}
html{scroll-behavior:smooth}
body{
  font-family:'Noto Sans HK','Inter',-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  background-image:
    radial-gradient(ellipse at 10% 40%,rgba(45,212,191,.045) 0%,transparent 55%),
    radial-gradient(ellipse at 90% 15%,rgba(167,139,250,.04) 0%,transparent 55%),
    radial-gradient(ellipse at 50% 95%,rgba(251,191,36,.025) 0%,transparent 50%);
  background-attachment:fixed;color:var(--t2);min-height:100vh;
  -webkit-font-smoothing:antialiased;
}

/* ========== TOP BAR ========== */
.topbar{
  position:sticky;top:0;z-index:100;
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 24px;
  background:rgba(10,14,26,.88);
  backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
  border-bottom:1px solid var(--bdr);
}
.topbar-brand{display:flex;align-items:center;gap:10px;font-weight:700;font-size:15px;color:var(--t1)}
.bus-emoji{font-size:22px;display:inline-block;animation:wiggle 3s ease-in-out infinite}
@keyframes wiggle{0%,100%{transform:translateX(0) rotate(0)}25%{transform:translateX(3px) rotate(1deg)}75%{transform:translateX(-2px) rotate(-.5deg)}}
.topbar-r{display:flex;align-items:center;gap:14px}
.lang-btn{
  background:var(--glass);border:1px solid var(--bdr-l);color:var(--t2);
  padding:6px 18px;border-radius:20px;cursor:pointer;font-size:13px;font-weight:600;
  letter-spacing:.5px;transition:all .25s ease;font-family:inherit;
}
.lang-btn:hover{background:var(--glass-h);color:var(--t1);border-color:rgba(255,255,255,.2)}
.clock{font-variant-numeric:tabular-nums;font-weight:600;font-size:14px;color:var(--t1);letter-spacing:1px}

/* ========== HERO ========== */
.hero{
  position:relative;overflow:hidden;padding:52px 24px 76px;text-align:center;
  background:linear-gradient(160deg,#0f1b33 0%,#1a1040 40%,#0d1f3c 100%);
}
.hero::before{
  content:'';position:absolute;inset:0;pointer-events:none;
  background:
    radial-gradient(circle at 30% 60%,rgba(45,212,191,.08) 0%,transparent 40%),
    radial-gradient(circle at 70% 30%,rgba(167,139,250,.08) 0%,transparent 40%);
}
.hero-mountain{position:absolute;bottom:0;left:0;width:100%;opacity:.06;pointer-events:none}
.hero-title{
  font-size:clamp(26px,5vw,42px);font-weight:900;line-height:1.3;position:relative;
  background:linear-gradient(135deg,#fff 0%,#cbd5e1 50%,#e2e8f0 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.hero-sub{
  margin-top:12px;font-size:clamp(12px,2.5vw,15px);color:var(--t3);
  font-weight:400;letter-spacing:.3px;position:relative;
}
.hero-meta{margin-top:22px;display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap;position:relative}
.day-badge{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 18px;border-radius:20px;font-size:13px;font-weight:600;
  cursor:pointer;transition:all .25s ease;user-select:none;
}
.day-badge.on{background:var(--amber-d);color:var(--amber);border:1px solid rgba(251,191,36,.35)}
.day-badge.off{background:var(--glass);color:var(--t4);border:1px solid var(--bdr)}
.day-badge.off:hover{color:var(--t3);border-color:var(--bdr-l)}
.day-auto{font-size:11px;color:var(--t4);margin-top:6px;width:100%;text-align:center}
.day-auto a{color:var(--t3);cursor:pointer;text-decoration:underline;text-underline-offset:2px}

/* ========== WAVE ========== */
.wave-wrap{position:relative;margin-top:-2px;line-height:0}
.wave-wrap svg{display:block;width:100%}

/* ========== DASHBOARD ========== */
.dashboard{max-width:1100px;margin:-32px auto 0;padding:0 20px;position:relative;z-index:10}
.dash-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
@media(max-width:720px){.dash-grid{grid-template-columns:1fr}}
.route-card{
  position:relative;overflow:hidden;
  background:rgba(17,24,39,.75);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  border:1px solid var(--bdr);border-radius:20px;padding:24px;
  cursor:pointer;transition:all .35s cubic-bezier(.4,0,.2,1);
}
.route-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--rc);opacity:.85}
.route-card:hover{
  background:rgba(17,24,39,.92);border-color:var(--bdr-l);
  transform:translateY(-3px);box-shadow:0 16px 48px rgba(0,0,0,.45);
}
.card-head{display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
.card-dir{font-size:15px;font-weight:700;color:var(--t1);line-height:1.4}
.card-dir .arr{color:var(--rc);margin:0 3px}
.card-tag{
  font-size:10px;color:var(--t4);background:var(--glass);padding:3px 10px;
  border-radius:10px;white-space:nowrap;border:1px solid var(--bdr);flex-shrink:0;
}
.card-transit{
  margin-top:14px;display:flex;align-items:center;gap:6px;font-size:12px;
  color:var(--green);background:rgba(52,211,153,.08);
  padding:8px 12px;border-radius:10px;border:1px solid rgba(52,211,153,.15);
}
.card-transit b{font-variant-numeric:tabular-nums}
.next-label{
  display:flex;align-items:center;gap:8px;margin-top:18px;
  font-size:11px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:1.5px;
}
.pulse{
  width:8px;height:8px;border-radius:50%;background:var(--rc);
  box-shadow:0 0 10px var(--rc);animation:pDot 2s ease-in-out infinite;
}
@keyframes pDot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.45;transform:scale(.75)}}
.next-time{
  font-size:clamp(34px,6vw,50px);font-weight:800;color:var(--t1);
  margin-top:2px;font-variant-numeric:tabular-nums;letter-spacing:2px;line-height:1.15;
}
.next-time .star{font-size:16px;color:var(--amber);vertical-align:super;margin-left:2px}
.countdown{font-size:15px;font-weight:600;margin-top:4px}
.cd-soon{color:var(--amber)}
.cd-now{color:var(--green);animation:pDot 1s ease-in-out infinite}
.cd-norm{color:var(--t3)}
.card-arr{margin-top:14px;font-size:12px;color:var(--t4);display:flex;align-items:center;gap:6px}
.card-arr b{color:var(--t3);font-weight:600;font-variant-numeric:tabular-nums}
.card-later{margin-top:12px;padding-top:12px;border-top:1px solid var(--bdr);font-size:12px;color:var(--t4)}
.later-row{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}
.later-row span{
  background:var(--glass);border:1px solid var(--bdr);
  padding:4px 10px;border-radius:8px;font-size:13px;font-weight:500;
  color:var(--t3);font-variant-numeric:tabular-nums;
}
.card-ended{margin-top:16px;text-align:center;padding:16px 0}
.ended-msg{font-size:14px;color:var(--t4);font-weight:500}
.ended-first{font-size:12px;color:var(--t4);margin-top:6px}
.ended-first b{color:var(--t3)}

/* ========== TIMETABLE ========== */
.tt-section{max-width:1100px;margin:44px auto 0;padding:0 20px}
.sec-title{
  font-size:19px;font-weight:700;color:var(--t1);margin-bottom:18px;
  display:flex;align-items:center;gap:8px;
}
.sec-title::before{content:'';width:4px;height:22px;border-radius:2px;background:var(--violet)}
.tabs{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;-ms-overflow-style:none}
.tabs::-webkit-scrollbar{display:none}
.tab{
  flex-shrink:0;padding:10px 18px;border-radius:12px;border:1px solid var(--bdr);
  background:var(--glass);color:var(--t3);font-size:13px;font-weight:600;
  cursor:pointer;transition:all .25s ease;white-space:nowrap;font-family:inherit;
}
.tab:hover{background:var(--glass-h);color:var(--t2)}
.tab.on{font-weight:700}
.tab.on[data-c="teal"]{background:var(--teal-d);color:var(--teal);border-color:rgba(45,212,191,.35)}
.tab.on[data-c="cyan"]{background:var(--cyan-d);color:var(--cyan);border-color:rgba(34,211,238,.35)}
.tab.on[data-c="violet"]{background:var(--violet-d);color:var(--violet);border-color:rgba(167,139,250,.35)}
.tab.on[data-c="purple"]{background:var(--purple-d);color:var(--purple);border-color:rgba(192,132,252,.35)}
.tt-info{margin-top:16px;font-size:13px;color:var(--t3);font-weight:500;margin-bottom:6px}
.legend{display:flex;gap:14px;flex-wrap:wrap;font-size:11px;color:var(--t4);margin-bottom:10px}
.legend span{display:inline-flex;align-items:center;gap:4px}
.legend .dot{width:10px;height:10px;border-radius:3px;display:inline-block}
.time-grid{
  display:flex;flex-wrap:wrap;gap:6px;padding:20px;
  background:rgba(17,24,39,.5);border:1px solid var(--bdr);border-radius:18px;
}
.chip{
  display:inline-flex;align-items:center;justify-content:center;gap:3px;
  padding:8px 13px;border-radius:10px;font-size:14px;font-weight:500;
  font-variant-numeric:tabular-nums;background:var(--glass);
  border:1px solid var(--bdr);color:var(--t2);transition:all .2s ease;
  min-width:72px;
}
.chip.past{opacity:.25;color:var(--t4)}
.chip.next{
  background:var(--amber-d);color:var(--amber);border-color:rgba(251,191,36,.45);
  box-shadow:0 0 20px rgba(251,191,36,.15);font-weight:700;
  animation:glow 2.5s ease-in-out infinite;
}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(251,191,36,.15)}50%{box-shadow:0 0 32px rgba(251,191,36,.3)}}
.chip.transit{background:rgba(52,211,153,.1);color:var(--green);border-color:rgba(52,211,153,.3)}
.chip .s{font-size:8px;color:var(--amber);opacity:.7}

/* ========== FOOTER ========== */
.footer{max-width:1100px;margin:44px auto 0;padding:0 20px 56px}
.notes{background:rgba(17,24,39,.5);border:1px solid var(--bdr);border-radius:18px;padding:22px}
.notes h3{font-size:14px;font-weight:700;color:var(--t3);margin-bottom:10px}
.notes ul{list-style:none}
.notes li{font-size:13px;color:var(--t4);padding:3px 0 3px 16px;position:relative;line-height:1.6}
.notes li::before{content:'‚Ä¢';position:absolute;left:0;color:var(--t4)}
.credits{margin-top:20px;text-align:center;font-size:11px;color:var(--t4)}
.credits a{color:var(--t3);text-decoration:none}

/* ========== RESPONSIVE ========== */
@media(max-width:520px){
  .topbar{padding:10px 14px}
  .hero{padding:36px 14px 56px}
  .dashboard{padding:0 10px;margin-top:-22px}
  .dash-grid{gap:10px}
  .route-card{padding:18px}
  .next-time{font-size:30px}
  .tab{padding:8px 13px;font-size:12px}
  .time-grid{padding:14px;gap:4px}
  .chip{padding:6px 8px;font-size:12px;min-width:58px}
  .tt-section,.footer{padding:0 10px}
}
@media(prefers-reduced-motion:reduce){*{animation-duration:.01ms!important}}
</style>
</head>
<body>

<!-- ===== TOP BAR ===== -->
<nav class="topbar">
  <div class="topbar-brand"><span class="bus-emoji">üöå</span><span id="tBrand"></span></div>
  <div class="topbar-r">
    <span class="clock" id="clock"></span>
    <button class="lang-btn" id="langBtn" onclick="toggleLang()"></button>
  </div>
</nav>

<!-- ===== HERO ===== -->
<section class="hero">
  <!-- Mountain silhouette -->
  <svg class="hero-mountain" viewBox="0 0 1440 220" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0,220 L0,180 Q100,120 200,150 Q320,60 440,110 Q520,30 640,80 Q720,10 820,70 Q920,20 1020,90 Q1120,40 1200,100 Q1300,60 1440,130 L1440,220Z" fill="#fff"/>
  </svg>
  <h1 class="hero-title" id="hTitle"></h1>
  <p class="hero-sub" id="hSub"></p>
  <div class="hero-meta" id="hMeta"></div>
</section>

<!-- ===== WAVE ===== -->
<div class="wave-wrap">
  <svg viewBox="0 0 1440 54" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0,27 C360,54 720,0 1080,27 C1260,40 1380,20 1440,27 L1440,54 L0,54Z" fill="#0a0e1a"/>
  </svg>
</div>

<!-- ===== DASHBOARD ===== -->
<section class="dashboard"><div class="dash-grid" id="grid"></div></section>

<!-- ===== TIMETABLE ===== -->
<section class="tt-section">
  <div class="sec-title" id="secT"></div>
  <div class="tabs" id="tabs"></div>
  <div id="ttBody"></div>
</section>

<!-- ===== FOOTER ===== -->
<section class="footer">
  <div class="notes" id="notes"></div>
  <div class="credits">
    Data source: Symphony Bay Shuttle Bus Time Schedule ¬∑
    <a href="https://github.com/hkbus/hk-bus-crawling" target="_blank" rel="noopener">hkbus/hk-bus-crawling</a>
  </div>
</section>

<script>
/* ==============================================================
   SCHEDULE DATA
   ============================================================== */
const R=[
{id:'VC_to_SC',zh:{f:'Âá±Âº¶Â±Ö',t:'Êñ∞Ê∏ØÂüé',a:'È¶¨ÈûçÂ±±'},en:{f:'Villa Concerto',t:'Sunshine City',a:'Ma On Shan'},
 tr:10,color:'teal',
 wd:['*06:15','*06:30','*06:40','07:01','07:16','07:21','07:31','07:41','07:51','08:01','08:11','08:21','08:31','08:41','08:51','09:01','09:21','09:41','10:01','10:21','10:41','11:01','11:21','11:41','12:01','12:21','12:41','13:01','13:21','13:41','*14:00','14:21','14:41','*15:00','15:21','15:41','16:01','16:21','16:41','17:01','17:21','17:41','18:01','18:21','18:41','19:01','19:21','19:41','20:01','*20:20','*20:40','*21:00','*21:20','*21:40','*22:10','*22:40'],
 we:['*06:15','*06:35','07:01','07:21','07:41','08:01','08:21','08:41','09:01','09:21','09:41','10:01','10:21','10:41','11:01','11:21','11:41','12:01','12:21','12:41','13:01','13:21','13:41','14:01','14:21','14:41','15:01','15:21','15:41','16:01','16:21','16:41','17:01','17:21','17:41','18:01','18:21','18:41','19:01','19:21','19:41','20:01','20:21','*20:40','*21:00','*21:20','*21:40','*22:10','*22:40']},
{id:'SC_to_VC',zh:{f:'Êñ∞Ê∏ØÂüé',t:'Âá±Âº¶Â±Ö',a:'È¶¨ÈûçÂ±±'},en:{f:'Sunshine City',t:'Villa Concerto',a:'Ma On Shan'},
 tr:10,color:'cyan',
 wd:['07:10','07:22','07:37','07:47','07:57','08:07','08:17','08:27','08:37','08:47','08:57','09:10','09:30','09:50','10:10','10:30','10:50','11:10','11:30','11:50','12:10','12:30','12:50','13:10','13:30','13:50','*14:00','14:30','14:50','*15:00','15:30','15:50','16:10','16:30','16:50','17:10','17:30','17:50','18:10','18:30','18:50','19:10','19:30','19:50','20:10','*20:15','*20:30','20:55','*21:15','*21:35','*21:55','*22:15','*22:45','*23:15'],
 we:['07:10','07:30','07:50','08:10','08:30','08:50','09:10','09:30','09:50','10:10','10:30','10:50','11:10','11:30','11:50','12:10','12:30','12:50','13:10','13:30','13:50','14:10','14:30','14:50','15:10','15:30','15:50','16:10','16:30','16:50','17:10','17:30','17:50','18:10','18:30','18:50','19:10','19:30','19:50','20:10','20:30','*20:50','*21:15','*21:35','*21:55','*22:15','*22:45','*23:15']},
{id:'VC_to_NTP',zh:{f:'Âá±Âº¶Â±Ö',t:'Êñ∞ÂüéÂ∏ÇÂª£Â†¥',a:'Ê≤ôÁî∞'},en:{f:'Villa Concerto',t:'New Town Plaza',a:'Sha Tin'},
 tr:20,color:'violet',
 wd:['*06:15','*06:30','*06:40','07:00','07:10','07:20','07:35','07:45','07:55','08:10','08:20','08:30','08:45','09:00','09:20','09:40','10:00','10:20','10:40','11:00','11:20','11:40','12:00','12:20','12:40','13:00','13:30','*14:00','14:30','15:00','15:20','15:40','16:00','16:15','16:30','16:45','17:00','17:15','17:30','17:45','18:00','18:15','18:30','18:45','19:00','19:15','19:30','19:45','20:00','*20:20','*20:40','*21:00','*21:20','*21:40','*22:10','*22:40'],
 we:['*06:15','*06:35','07:00','07:20','07:40','08:00','08:15','08:30','08:45','09:00','09:20','09:40','10:00','10:20','10:40','11:00','11:20','11:40','12:00','12:20','12:40','13:00','13:20','13:40','14:00','14:20','14:40','15:00','15:20','15:40','16:00','16:15','16:30','16:45','17:00','17:15','17:30','17:45','18:00','18:15','18:30','18:45','19:00','19:15','19:30','19:45','20:00','20:20','*20:40','*21:00','*21:20','*21:40','*22:10','*22:40']},
{id:'NTP_to_VC',zh:{f:'Êñ∞ÂüéÂ∏ÇÂª£Â†¥',t:'Âá±Âº¶Â±Ö',a:'Ê≤ôÁî∞'},en:{f:'New Town Plaza',t:'Villa Concerto',a:'Sha Tin'},
 tr:20,color:'purple',
 wd:['*06:35','*06:50','*07:00','07:25','07:35','07:50','08:00','08:10','08:25','08:35','08:45','09:00','09:15','09:35','09:55','10:15','10:35','10:55','11:15','11:35','11:55','12:15','12:35','12:55','13:15','*13:45','14:20','*14:45','15:20','15:35','15:55','16:15','16:30','16:45','17:00','17:15','17:30','17:45','18:00','18:15','18:30','18:45','19:00','19:15','19:30','19:45','*20:00','*20:15','*20:40','*21:00','*21:20','*21:40','*22:00','*22:30','*23:00'],
 we:['06:35','06:55','07:15','07:35','07:55','08:15','08:30','08:45','09:00','09:15','09:35','09:55','10:15','10:35','10:55','11:15','11:35','11:55','12:15','12:35','12:55','13:15','13:35','13:55','14:15','14:35','14:55','15:15','15:35','15:55','16:15','16:30','16:45','17:00','17:15','17:30','17:45','18:00','18:15','18:30','18:45','19:00','19:15','19:30','19:45','20:00','20:15','*20:35','*21:00','*21:20','*21:40','*22:00','*22:30','*23:00']}
];

/* ==============================================================
   LOCALISATION
   ============================================================== */
const L={
zh:{brand:'Á©øÊ¢≠Â∑¥Â£´',title:'Á©øÊ¢≠Â∑¥Â£´ÊôÇÂàªË°®',
 sub:'Âá±Âº¶Â±Ö ‚Üî Êñ∞Ê∏ØÂüéÔºàÈ¶¨ÈûçÂ±±ÔºâÔºè Êñ∞ÂüéÂ∏ÇÂª£Â†¥ÔºàÊ≤ôÁî∞Ôºâ',
 wd:'Âπ≥Êó•',we:'ÂÅáÊó•',wdF:'ÊòüÊúü‰∏ÄËá≥‰∫îÔºàÂÖ¨ÁúæÂÅáÊúüÈô§Â§ñÔºâ',weF:'ÊòüÊúüÂÖ≠„ÄÅÊó•ÂèäÂÖ¨ÁúæÂÅáÊúü',
 auto:'Ëá™ÂãïÂÅµÊ∏¨',reset:'‚Ü© ÈáçË®≠ÁÇ∫Ëá™Âãï',tap:'ÈªûÊìäÂàáÊèõ',
 next:'‰∏ã‰∏ÄÁè≠',inMin:'ÂàÜÈêòÂæåÂá∫Áôº',soon:'Âç≥Â∞áÂá∫Áôº',
 ended:'‰ªäÊó•ÊúçÂãôÂ∑≤ÁµêÊùü',tmr:'ÊòéÊó•È¶ñÁè≠Ëªä',
 eta:'È†êË®àÂà∞ÈÅî',ride:'ÂàÜÈêòËªäÁ®ã',after:'‰πãÂæå',
 fullTT:'ÂÆåÊï¥ÊôÇÂàªË°®',notes:'ÂÇôË®ª',
 n1:'Ê®ôÁ§∫ ‚òÖ ‰πãÁè≠Ê¨°ÁÇ∫ÂéüÊôÇÈñìË°®ÊòüËôüÁè≠Ê¨°„ÄÇ',
 n2:'Áè≠Ê¨°ÊàñÊúÉÂõ†ÊáâÂØ¶Èöõ‰∫§ÈÄöÊÉÖÊ≥ÅË™øÊï¥„ÄÇ',
 n3:'Headway would be adjusted subject to actual traffic condition.',
 btn:'EN',transit:'Ë°åÈßõ‰∏≠',to:'‚Üí',
 lgNx:'‰∏ã‰∏ÄÁè≠',lgTr:'Ë°åÈßõ‰∏≠',lgDep:'Â∑≤ÈñãÂá∫',lgSp:'ÁâπÂà•Áè≠Ê¨°',
 days:['ÊòüÊúüÊó•','ÊòüÊúü‰∏Ä','ÊòüÊúü‰∫å','ÊòüÊúü‰∏â','ÊòüÊúüÂõõ','ÊòüÊúü‰∫î','ÊòüÊúüÂÖ≠']},
en:{brand:'Shuttle Bus',title:'Shuttle Bus Timetable',
 sub:'Villa Concerto ‚Üî Sunshine City (Ma On Shan) / New Town Plaza (Sha Tin)',
 wd:'Weekday',we:'Weekend',wdF:'Mon ‚Äì Fri (excl. Public Holidays)',weF:'Sat, Sun & Public Holidays',
 auto:'Auto-detect',reset:'‚Ü© Reset to auto',tap:'Tap to switch',
 next:'NEXT BUS',inMin:'min to departure',soon:'Departing now',
 ended:'Service ended for today',tmr:'First bus tomorrow',
 eta:'Est. arrival',ride:'min ride',after:'Then',
 fullTT:'Full Timetable',notes:'Notes',
 n1:'Services marked ‚òÖ are asterisked in the original timetable.',
 n2:'Headway would be adjusted subject to actual traffic condition.',n3:'',
 btn:'‰∏≠Êñá',transit:'In transit',to:'‚Üí',
 lgNx:'Next',lgTr:'In transit',lgDep:'Departed',lgSp:'Special',
 days:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']}
};

/* ==============================================================
   STATE
   ============================================================== */
let lang='zh',forceDay=null,activeTab='VC_to_SC';
try{const s=localStorage.getItem('sbLang');if(s==='en'||s==='zh')lang=s}catch(e){}

/* ==============================================================
   HELPERS
   ============================================================== */
const $=id=>document.getElementById(id);
const T=k=>L[lang][k];
const pad=n=>n.toString().padStart(2,'0');

function hk(){
  const s=new Date().toLocaleString('en-US',{timeZone:'Asia/Hong_Kong'});
  return new Date(s);
}
function hkH(){return hk().getHours()}
function hkM(){return hk().getMinutes()}
function hkS(){return hk().getSeconds()}
function hkD(){return hk().getDay()}
function nowM(){return hkH()*60+hkM()}

function pT(s){
  const sp=s.startsWith('*'),c=s.replace('*',''),p=c.split(':').map(Number);
  return{h:p[0],m:p[1],tot:p[0]*60+p[1],sp,disp:c};
}
function dayType(){
  if(forceDay)return forceDay;
  const d=hkD();return(d===0||d===6)?'we':'wd';
}
function times(r){return dayType()==='wd'?r.wd:r.we}
function nextI(ts){
  const n=nowM(),sec=hkS();
  for(let i=0;i<ts.length;i++){
    const t=pT(ts[i]).tot;
    if(t>n)return i;
    if(t===n&&sec<30)return i;
  }
  return -1;
}
function addM(disp,mins){
  const[h,m]=disp.split(':').map(Number);
  let nm=m+mins,nh=h;
  if(nm>=60){nh+=Math.floor(nm/60);nm%=60}
  if(nh>=24)nh-=24;
  return pad(nh)+':'+pad(nm);
}

const cMap={teal:'var(--teal)',cyan:'var(--cyan)',violet:'var(--violet)',purple:'var(--purple)'};

/* ==============================================================
   RENDER ‚Äî CLOCK
   ============================================================== */
function rClock(){$('clock').textContent=pad(hkH())+':'+pad(hkM())+':'+pad(hkS())}

/* ==============================================================
   RENDER ‚Äî HERO
   ============================================================== */
function rHero(){
  $('tBrand').textContent=T('brand');
  $('hTitle').textContent=T('title');
  $('hSub').textContent=T('sub');
  $('langBtn').textContent=T('btn');
  const dt=dayType(),dn=T('days')[hkD()];
  const onWd=dt==='wd'?'on':'off',onWe=dt==='we'?'on':'off';
  const auto=!forceDay;
  $('hMeta').innerHTML=`
    <span class="day-badge ${onWd}" onclick="setDay('wd')" title="${T('tap')}">üìÖ ${T('wd')}${dt==='wd'&&auto?' ‚úì':''}</span>
    <span class="day-badge ${onWe}" onclick="setDay('we')" title="${T('tap')}">üéâ ${T('we')}${dt==='we'&&auto?' ‚úì':''}</span>
    <div class="day-auto">${auto
      ?`ü§ñ ${T('auto')} ¬∑ ${dn} ¬∑ ${dt==='wd'?T('wdF'):T('weF')}`
      :`<a onclick="setDay(null)">${T('reset')}</a> ¬∑ ${dt==='wd'?T('wdF'):T('weF')}`
    }</div>`;
}
function setDay(v){forceDay=(forceDay===v)?null:v;rAll()}

/* ==============================================================
   RENDER ‚Äî DASHBOARD CARDS
   ============================================================== */
function rDash(){
  $('grid').innerHTML=R.map(r=>{
    const ts=times(r),ps=ts.map(pT),ni=nextI(ts),loc=r[lang],n=nowM(),c=cMap[r.color];
    let body='';

    // Check in-transit bus
    function transitHTML(idx){
      if(idx<0||idx>=ps.length)return '';
      const p=ps[idx],dep=n-p.tot;
      if(dep>=0&&dep<r.tr){
        const arr=addM(p.disp,r.tr),left=r.tr-dep;
        return `<div class="card-transit">üöå <span>${T('transit')}</span>&nbsp;‚Üí&nbsp;${T('eta')} <b>${arr}</b>&nbsp;(${left} ${lang==='zh'?'ÂàÜÈêò':'min'})</div>`;
      }
      return '';
    }

    if(ni===-1){
      const first=pT(ts[0]);
      const trH=transitHTML(ps.length-1);
      body=`${trH}<div class="card-ended"><div class="ended-msg">üò¥ ${T('ended')}</div><div class="ended-first">${T('tmr')}Ôºö<b>${first.disp}</b></div></div>`;
    }else{
      const nx=ps[ni],diff=nx.tot-n;
      let cdC,cdT;
      if(diff<=0){cdC='cd-now';cdT='üöå '+T('soon')}
      else if(diff<=3){cdC='cd-soon';cdT=diff+' '+T('inMin')}
      else{cdC='cd-norm';cdT=diff+' '+T('inMin')}
      const arrT=addM(nx.disp,r.tr);
      const trH=ni>0?transitHTML(ni-1):'';
      const later=[];
      for(let j=ni+1;j<Math.min(ni+4,ps.length);j++)later.push(ps[j].disp);

      body=`${trH}
        <div class="next-label"><span class="pulse" style="background:${c};box-shadow:0 0 10px ${c}"></span>${T('next')}</div>
        <div class="next-time">${nx.disp}${nx.sp?'<span class="star">‚òÖ</span>':''}</div>
        <div class="countdown ${cdC}">${cdT}</div>
        <div class="card-arr">üèÅ ${T('eta')} <b>~${arrT}</b></div>
        ${later.length?`<div class="card-later">${T('after')}<div class="later-row">${later.map(l=>'<span>'+l+'</span>').join('')}</div></div>`:''}`;
    }
    return `<div class="route-card" style="--rc:${c}" onclick="selTab('${r.id}')">
      <div class="card-head">
        <div class="card-dir">${loc.f} <span class="arr">${T('to')}</span> ${loc.t}</div>
        <div class="card-tag">‚è± ${r.tr} ${T('ride')}</div>
      </div>${body}</div>`;
  }).join('');
}

/* ==============================================================
   RENDER ‚Äî TIMETABLE TABS + GRID
   ============================================================== */
function rTabs(){
  $('secT').textContent=T('fullTT');
  $('tabs').innerHTML=R.map(r=>{
    const loc=r[lang],on=r.id===activeTab?'on':'';
    return `<button class="tab ${on}" data-c="${r.color}" onclick="selTab('${r.id}')">${loc.f} ${T('to')} ${loc.t}</button>`;
  }).join('');
}

function rGrid(){
  const r=R.find(x=>x.id===activeTab);
  if(!r){$('ttBody').innerHTML='';return}
  const ts=times(r),ps=ts.map(pT),ni=nextI(ts),loc=r[lang],n=nowM();
  const dayL=dayType()==='wd'?T('wdF'):T('weF');

  const chips=ps.map((p,i)=>{
    let cls='chip';
    const isPast=ni===-1||i<ni;
    if(i===ni&&ni!==-1){cls+=' next'}
    else if(isPast){
      const dep=n-p.tot;
      cls+=(dep>=0&&dep<r.tr)?' transit':' past';
    }
    if(p.sp)cls+=' special';
    return `<span class="${cls}">${p.sp?'<span class="s">‚òÖ </span>':''}${p.disp}</span>`;
  }).join('');

  $('ttBody').innerHTML=`
    <div class="tt-info">${loc.f} ${T('to')} ${loc.t}„ÄÄ¬∑„ÄÄ${dayL}„ÄÄ¬∑„ÄÄ‚è± ${r.tr} ${T('ride')}</div>
    <div class="legend">
      <span><span class="dot" style="background:var(--amber)"></span>${T('lgNx')}</span>
      <span><span class="dot" style="background:var(--green)"></span>${T('lgTr')}</span>
      <span><span class="dot" style="background:var(--t4);opacity:.3"></span>${T('lgDep')}</span>
      <span><span class="s" style="color:var(--amber);font-size:12px">‚òÖ</span> ${T('lgSp')}</span>
    </div>
    <div class="time-grid">${chips}</div>`;
}

function selTab(id){
  activeTab=id;rTabs();rGrid();
  document.querySelector('.tt-section').scrollIntoView({behavior:'smooth',block:'start'});
}

/* ==============================================================
   RENDER ‚Äî FOOTER
   ============================================================== */
function rFoot(){
  $('notes').innerHTML=`<h3>${T('notes')}</h3><ul>
    <li>${T('n1')}</li><li>${T('n2')}</li>
    ${T('n3')?'<li>'+T('n3')+'</li>':''}</ul>`;
}

/* ==============================================================
   RENDER ALL
   ============================================================== */
function rAll(){rHero();rDash();rTabs();rGrid();rFoot()}

/* ==============================================================
   LANGUAGE TOGGLE
   ============================================================== */
function toggleLang(){
  lang=lang==='zh'?'en':'zh';
  try{localStorage.setItem('sbLang',lang)}catch(e){}
  rAll();
}

/* ==============================================================
   INIT
   ============================================================== */
(function init(){
  rClock();rAll();
  setInterval(rClock,1000);
  setInterval(()=>{rDash();rGrid()},15000);
})();
</script>
</body>
</html>
